<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container my-5">
    <div class="card shadow-sm">
      <div class="card-body">
        <h2 class="card-title mb-4">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à</h2>
        <div class="table-responsive">
          <table class="table table-bordered table-striped align-middle text-center">
            <thead class="table-primary">
              <tr>
                <th style="width: 40%">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</th>
                <th>1</th>
                <th>2</th>
                <th>3</th>
                <th>4</th>
                <th>5</th>
                <th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th>
                <th>SD</th>
              </tr>
            </thead>
            <tbody id="reportTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // üîπ Formatter ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢ (‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)
    const numFormat = new Intl.NumberFormat("th-TH", { minimumFractionDigits: 2, maximumFractionDigits: 2 });

    // üîπ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° + ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà)
    const questions = [{"id":1,"text":"‡πÇ‡∏î‡∏¢‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡πà‡∏≤‡∏ô‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ","topic":"‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤","order":1},{"id":2,"text":"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô","topic":"‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤","order":13},{"id":3,"text":"‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°","topic":"‡∏Å‡∏≤‡∏£‡∏ó‡∏ß‡∏ô‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ","order":20}];

    // üîπ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö 10 ‡∏Ñ‡∏ô √ó 10 ‡∏Ç‡πâ‡∏≠)
    const rawData = [[3,2,1],[4,4,4],[2,3,4],[5,4,4],[4,2,1]];

    // üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
    function calculateStats(values) {
      const frequencies = [0, 0, 0, 0, 0];
      values.forEach(v => { frequencies[v - 1]++; });

      const meanRaw = values.reduce((a, b) => a + b, 0) / values.length;
      const variance = values.reduce((a, b) => a + Math.pow(b - meanRaw, 2), 0) / values.length;
      const sdRaw = Math.sqrt(variance);

      return {
        frequencies,
        mean: numFormat.format(meanRaw),
        sd: numFormat.format(sdRaw)
      };
    }

    // üîπ ‡πÅ‡∏õ‡∏•‡∏á rawData ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô column (‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°)
    const cols = Array(questions.length).fill().map((_, colIndex) =>
      rawData.map(row => row[colIndex])
    );

    // üîπ Group ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏≤‡∏° topic
    const grouped = {};
    questions.forEach((q, idx) => {
      if (!grouped[q.topic]) grouped[q.topic] = [];
      grouped[q.topic].push({ ...q, values: cols[idx] });
    });

    // üîπ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    const tbody = document.getElementById("reportTableBody");
    let allValues = [];
    Object.entries(grouped).forEach(([topic, items]) => {
      // ‡πÅ‡∏ñ‡∏ß‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ topic
      const trTopic = document.createElement("tr");
      trTopic.classList.add("table-secondary");
      trTopic.innerHTML = `<td colspan="8" class="fw-bold text-start">${topic}</td>`;
      tbody.appendChild(trTopic);

      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° order
      items.sort((a, b) => a.order - b.order);

      // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏ô topic ‡∏ô‡∏±‡πâ‡∏ô
      let topicValues = [];
      items.forEach((q) => {
        const stats = calculateStats(q.values);
        topicValues = topicValues.concat(q.values);
        allValues = allValues.concat(q.values);

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="text-start">${q.id}. ${q.text}</td>
          ${stats.frequencies.map(f => `<td>${f}</td>`).join("")}
          <td><b>${stats.mean}</b></td>
          <td>${stats.sd}</td>
        `;
        tbody.appendChild(tr);
      });

      // ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á topic
      const summaryStats = calculateStats(topicValues);
      const trSummary = document.createElement("tr");
      trSummary.classList.add("table-info");
      trSummary.innerHTML = `
        <td class="text-start fw-bold">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏£‡∏ß‡∏°: ${topic}</td>
        ${summaryStats.frequencies.map(f => `<td>${f}</td>`).join("")}
        <td><b>${summaryStats.mean}</b></td>
        <td>${summaryStats.sd}</td>
      `;
      tbody.appendChild(trSummary);
    });

    // üîπ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
    const overallStats = calculateStats(allValues);
    const trOverall = document.createElement("tr");
    trOverall.classList.add("table-success");
    trOverall.innerHTML = `
      <td class="text-start fw-bold">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</td>
      ${overallStats.frequencies.map(f => `<td>${f}</td>`).join("")}
      <td><b>${overallStats.mean}</b></td>
      <td>${overallStats.sd}</td>
    `;
    tbody.appendChild(trOverall);
  </script>
</body>
</html>
